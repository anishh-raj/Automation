package Activity1;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.chrome.ChromeOptions;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;

import java.time.Duration;
import java.util.List;
import java.util.concurrent.TimeUnit;

public class SpeedTesting {

    public static void main(String[] args) {
        WebDriver driver = setupDriver();

        driver.get("https://pagespeed.web.dev/");

        WebElement urlInput = driver.findElement(By.id("i4"));
        urlInput.sendKeys("stattimes.com");

        WebElement analyzeButton = driver.findElement(By.xpath("//span[text()='Analyze']"));
        analyzeButton.click();

        WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(100));
        wait.until(ExpectedConditions.urlContains("https://pagespeed.web.dev/analysis/"));

        WebElement assessmentStatusElement = wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//span[contains(text(),'Passed') or contains(text(),'Failed')]")));
        String assessmentStatus = assessmentStatusElement.getText();

        System.out.println("Core Web Vitals Assessment: " + assessmentStatus);

        String[] metricLabels = {"LCP", "FID", "CLS", "FCP", "INP", "TTFB"};
        for (int i = 0; i < metricLabels.length; i++) {
            WebElement metricElement = wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("(//span[@class='Ykn2A YznLle' or @class='Ykn2A LR2yK'])[" + (i + 1) + "]")));
            String metricValue = metricElement.getText();
            System.out.println(metricLabels[i] + ": " + metricValue);
        }
        String[] customMetrics = {"First Contentful Paint", "Largest Contentful Paint", "Total Blocking Time", "Cumulative Layout Shift", "Speed Index"};
        for (int i = 0; i < metricLabels.length; i++) {
        	WebElement customElements = wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("(//div[@class='lh-metric__value'])[" + (i + 1) + "]")));
        	String metrics = customElements.getText();
        	System.out.println(customMetrics[i] + ": " + metrics);
        	
        	//clicking the desktop button 
        	  WebElement desktopButton = driver.findElement(By.xpath(("(//span[@class='VfPpkd-YVzG2b' and @jsname='ksKsZd'])[2]")));
              desktopButton.click();
	
       
    }
        try {
            TimeUnit.SECONDS.sleep(5);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        driver.quit();
    }

    public static WebDriver setupDriver() {
        ChromeOptions opt = new ChromeOptions();
        opt.addArguments("--disable-notifications");
        opt.addArguments("--remote-allow-origins=*");

        System.setProperty("webdriver.chrome.driver", "//Users//apple//eclipse-workspace//Selenium //src//test//java//testing//chromedriver");

        return new ChromeDriver(opt);
    }
}
